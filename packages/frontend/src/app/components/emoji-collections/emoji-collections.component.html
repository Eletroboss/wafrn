<div class="emoji-position">
    <mat-form-field class="w-full mt-2">
      <mat-label>Search available emojis</mat-label>
      <input [(ngModel)]="filterText" matInput />
    </mat-form-field>

  <div #emojiContainer class="emoji-container">
    <div class="emoji-sidebar">
      <button
        [class.emoji-active-collection]="this.collectionHas(-1)"
        class="emoji-sidebar-child p-2 flex align-content-center justify-content-center cursor-pointer bg-transparent emoji-collection-button"
        (click)="this.toggleCollection(-1)"
      >
        <span title="All emojis" class="post-emoji-header">*</span>
      </button>
      <button
        [class.emoji-active-collection]="this.collectionHas(-2)"
        class="emoji-sidebar-child p-2 flex align-content-center justify-content-center cursor-pointer bg-transparent emoji-collection-button"
        (click)="this.toggleCollection(-2)"
      >
        <fa-icon class="post-emoji-header" title="Recent emojis" [icon]="clockIcon"></fa-icon>
      </button>
      @for (emojiCollection of emojiCollections; track $index) {
        @let emoji = emojiCollection.emojis[0];
        <button
          [class.emoji-active-collection]="this.collectionHas($index)"
          class="emoji-sidebar-child p-2 flex align-content-center justify-content-center cursor-pointer bg-transparent emoji-collection-button"
          (click)="toggleCollection($index)"
        >
          @if (!emoji.url) {
            {{ emoji.id }}
          }
          <img
            *ngIf="emoji.url"
            loading="lazy"
            class="post-emoji-header mr-2 ml-2"
            [src]="baseMediaUrl + emoji.url"
            [alt]="emojiCollection.name"
            [title]="emojiCollection.name"
          />
        </button>
      }
    </div>
    <hr />

    <cdk-virtual-scroll-viewport itemSize="50" class="emoji-viewport" minBufferPx="400" maxBufferPx="500">
      <div *cdkVirtualFor="let row of this.emojiRenderable()" class="emoji-row" [class.emoji-header]="row.tag === 0">
        @if (row.tag === 0) {
          <span>{{ row.name }}</span>
        } @else {
          @for (emoji of row.emos; track $index) {
            <button
              mat-flat-button
              [title]="emoji.name"
              (click)="click(emoji)"
              class="p-2 flex align-content-center justify-content-center cursor-pointer bg-transparent emoji-item"
            >
              @if (!emoji.url) {
                {{ emoji.id }}
              } @else {
                <img
                  loading="lazy"
                  class="post-emoji-preview mr-2 ml-2"
                  [src]="baseMediaUrl + emoji.url"
                  [alt]="emoji.name"
                />
              }
            </button>
          }
        }
      </div>
    </cdk-virtual-scroll-viewport>
  </div>
</div>
